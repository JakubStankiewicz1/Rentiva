name: Keep Backend Active

on:
  schedule:
    - cron: '*/2 * * * *' # co 2 minuty
  workflow_dispatch:

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
      - name: Check backend health
        run: |
          echo "=== Checking backend health ==="
          response=$(curl -s -w "%{http_code}" -o /dev/null https://rentiva-backend.onrender.com/api/health)
          echo "Health check status: $response"
          if [ "$response" = "200" ]; then
            echo "✅ Backend is healthy"
          else
            echo "❌ Backend health check failed: $response"
          fi
          
      - name: Fetch cars data
        run: |
          echo "=== Fetching cars data ==="
          response=$(curl -s -w "%{http_code}" -o /dev/null https://rentiva-backend.onrender.com/api/cars)
          echo "Cars API status: $response"
          if [ "$response" = "200" ]; then
            echo "✅ Cars data fetched successfully"
          else
            echo "❌ Cars API failed: $response"
          fi
          
      - name: Get car count
        run: |
          echo "=== Getting car count ==="
          response=$(curl -s -w "%{http_code}" -o /dev/null https://rentiva-backend.onrender.com/api/cars/count)
          echo "Car count status: $response"
          if [ "$response" = "200" ]; then
            echo "✅ Car count retrieved"
          else
            echo "❌ Car count failed: $response"
          fi
          
      - name: Check reservations
        run: |
          echo "=== Checking reservations ==="
          response=$(curl -s -w "%{http_code}" -o /dev/null https://rentiva-backend.onrender.com/api/reservations)
          echo "Reservations status: $response"
          if [ "$response" = "200" ]; then
            echo "✅ Reservations checked"
          else
            echo "❌ Reservations failed: $response"
          fi
          
      - name: Get upcoming reservations
        run: |
          echo "=== Getting upcoming reservations ==="
          response=$(curl -s -w "%{http_code}" -o /dev/null https://rentiva-backend.onrender.com/api/reservations/upcoming)
          echo "Upcoming reservations status: $response"
          if [ "$response" = "200" ]; then
            echo "✅ Upcoming reservations retrieved"
          else
            echo "❌ Upcoming reservations failed: $response"
          fi
          
      - name: Get reservation statistics
        run: |
          echo "=== Getting reservation statistics ==="
          response=$(curl -s -w "%{http_code}" -o /dev/null https://rentiva-backend.onrender.com/api/reservations/statistics)
          echo "Statistics status: $response"
          if [ "$response" = "200" ]; then
            echo "✅ Statistics retrieved"
          else
            echo "❌ Statistics failed: $response"
          fi
          
      - name: Test car search
        run: |
          echo "=== Testing car search ==="
          response=$(curl -s -w "%{http_code}" -o /dev/null "https://rentiva-backend.onrender.com/api/cars?search=BMW")
          echo "Search status: $response"
          if [ "$response" = "200" ]; then
            echo "✅ Car search working"
          else
            echo "❌ Car search failed: $response"
          fi
          
      - name: Test car filtering
        run: |
          echo "=== Testing car filtering ==="
          response=$(curl -s -w "%{http_code}" -o /dev/null "https://rentiva-backend.onrender.com/api/cars?brand=BMW&type=SUV")
          echo "Filter status: $response"
          if [ "$response" = "200" ]; then
            echo "✅ Car filtering working"
          else
            echo "❌ Car filtering failed: $response"
          fi
          
      - name: Test car brands
        run: |
          echo "=== Testing car brands ==="
          response=$(curl -s -w "%{http_code}" -o /dev/null "https://rentiva-backend.onrender.com/api/cars/brands/BMW")
          echo "Brands status: $response"
          if [ "$response" = "200" ]; then
            echo "✅ Car brands working"
          else
            echo "❌ Car brands failed: $response"
          fi
          
      - name: Test car types
        run: |
          echo "=== Testing car types ==="
          response=$(curl -s -w "%{http_code}" -o /dev/null "https://rentiva-backend.onrender.com/api/cars/types/SUV")
          echo "Types status: $response"
          if [ "$response" = "200" ]; then
            echo "✅ Car types working"
          else
            echo "❌ Car types failed: $response"
          fi
          
      - name: Final health check
        run: |
          echo "=== Final health check ==="
          response=$(curl -s -w "%{http_code}" -o /dev/null https://rentiva-backend.onrender.com/api/health)
          echo "Final health check status: $response"
          if [ "$response" = "200" ]; then
            echo "✅ Final health check passed"
          else
            echo "❌ Final health check failed: $response"
          fi
          echo "🎉 Backend keep-alive completed successfully!" 